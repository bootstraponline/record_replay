import{assert as t,MODES as e,ACTIONS as r,EXPIRY_STRATEGIES as n,Serializers as o,PollyError as i}from"@pollyjs/utils";var s={}.toString,u=function(t){return s.call(t).slice(8,-1)},c=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==u(t)?t.split(""):Object(t)},a=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},f=function(t){return c(a(t))},p={f:{}.propertyIsEnumerable},l=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},h=function(t){return"object"==typeof t?null!==t:"function"==typeof t},y=function(t,e){if(!h(t))return t;var r,n;if(e&&"function"==typeof(r=t.toString)&&!h(n=r.call(t)))return n;if("function"==typeof(r=t.valueOf)&&!h(n=r.call(t)))return n;if(!e&&"function"==typeof(r=t.toString)&&!h(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")},d={}.hasOwnProperty,g=function(t,e){return d.call(t,e)},m=function(t){try{return!!t()}catch(t){return!0}},b=!m(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a});function v(t,e){return t(e={exports:{}},e.exports),e.exports}var w=v(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),O=w.document,S=h(O)&&h(O.createElement),R=function(t){return S?O.createElement(t):{}},P=!b&&!m(function(){return 7!=Object.defineProperty(R("div"),"a",{get:function(){return 7}}).a}),j=Object.getOwnPropertyDescriptor,E={f:b?j:function(t,e){if(t=f(t),e=y(e,!0),P)try{return j(t,e)}catch(t){}if(g(t,e))return l(!p.f.call(t,e),t[e])}},_=v(function(t){var e=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=e)}),F=(_.version,function(t,e,r){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===e)return t;switch(r){case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,o){return t.call(e,r,n,o)}}return function(){return t.apply(e,arguments)}}),T=function(t){if(!h(t))throw TypeError(t+" is not an object!");return t},k=Object.defineProperty,q={f:b?Object.defineProperty:function(t,e,r){if(T(t),e=y(e,!0),T(r),P)try{return k(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[e]=r.value),t}},x=b?function(t,e,r){return q.f(t,e,l(1,r))}:function(t,e,r){return t[e]=r,t},N=function(t,e,r){var n,o,i,s=t&N.F,u=t&N.G,c=t&N.S,a=t&N.P,f=t&N.B,p=t&N.W,l=u?_:_[e]||(_[e]={}),h=l.prototype,y=u?w:c?w[e]:(w[e]||{}).prototype;for(n in u&&(r=e),r)(o=!s&&y&&void 0!==y[n])&&g(l,n)||(i=o?y[n]:r[n],l[n]=u&&"function"!=typeof y[n]?r[n]:f&&o?F(i,w):p&&y[n]==i?function(t){var e=function(e,r,n){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,r)}return new t(e,r,n)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(i):a&&"function"==typeof i?F(Function.call,i):i,a&&((l.virtual||(l.virtual={}))[n]=i,t&N.R&&h&&!h[n]&&x(h,n,i)))};N.F=1,N.G=2,N.S=4,N.P=8,N.B=16,N.W=32,N.U=64,N.R=128;var I=N,D=function(t,e){var r=(_.Object||{})[t]||Object[t],n={};n[t]=e(r),I(I.S+I.F*m(function(){r(1)}),"Object",n)},C=E.f;D("getOwnPropertyDescriptor",function(){return function(t,e){return C(f(t),e)}});var M,A=_.Object,W=function(t,e){return A.getOwnPropertyDescriptor(t,e)},$=x,J=0,z=Math.random(),G=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++J+z).toString(36))},K=v(function(t){var e=G("meta"),r=q.f,n=0,o=Object.isExtensible||function(){return!0},i=!m(function(){return o(Object.preventExtensions({}))}),s=function(t){r(t,e,{value:{i:"O"+ ++n,w:{}}})},u=t.exports={KEY:e,NEED:!1,fastKey:function(t,r){if(!h(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!g(t,e)){if(!o(t))return"F";if(!r)return"E";s(t)}return t[e].i},getWeak:function(t,r){if(!g(t,e)){if(!o(t))return!0;if(!r)return!1;s(t)}return t[e].w},onFreeze:function(t){return i&&u.NEED&&o(t)&&!g(t,e)&&s(t),t}}}),Y=(K.KEY,K.NEED,K.fastKey,K.getWeak,K.onFreeze,v(function(t){var e=w["__core-js_shared__"]||(w["__core-js_shared__"]={});(t.exports=function(t,r){return e[t]||(e[t]=void 0!==r?r:{})})("versions",[]).push({version:_.version,mode:"pure",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})})),H=v(function(t){var e=Y("wks"),r=w.Symbol,n="function"==typeof r;(t.exports=function(t){return e[t]||(e[t]=n&&r[t]||(n?r:G)("Symbol."+t))}).store=e}),L=q.f,U=H("toStringTag"),B=function(t,e,r){t&&!g(t=r?t:t.prototype,U)&&L(t,U,{configurable:!0,value:e})},Q={f:H},Z=q.f,V=function(t){var e=_.Symbol||(_.Symbol={});"_"==t.charAt(0)||t in e||Z(e,t,{value:Q.f(t)})},X=Math.ceil,tt=Math.floor,et=function(t){return isNaN(t=+t)?0:(t>0?tt:X)(t)},rt=Math.min,nt=Math.max,ot=Math.min,it=Y("keys"),st=function(t){return it[t]||(it[t]=G(t))},ut=(M=!1,function(t,e,r){var n,o,i=f(t),s=(n=i.length)>0?rt(et(n),9007199254740991):0,u=function(t,e){return(t=et(t))<0?nt(t+e,0):ot(t,e)}(r,s);if(M&&e!=e){for(;s>u;)if((o=i[u++])!=o)return!0}else for(;s>u;u++)if((M||u in i)&&i[u]===e)return M||u||0;return!M&&-1}),ct=st("IE_PROTO"),at=function(t,e){var r,n=f(t),o=0,i=[];for(r in n)r!=ct&&g(n,r)&&i.push(r);for(;e.length>o;)g(n,r=e[o++])&&(~ut(i,r)||i.push(r));return i},ft="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),pt=Object.keys||function(t){return at(t,ft)},lt={f:Object.getOwnPropertySymbols},ht=Array.isArray||function(t){return"Array"==u(t)},yt=function(t){return Object(a(t))},dt=b?Object.defineProperties:function(t,e){T(t);for(var r,n=pt(e),o=n.length,i=0;o>i;)q.f(t,r=n[i++],e[r]);return t},gt=w.document,mt=gt&&gt.documentElement,bt=st("IE_PROTO"),vt=function(){},wt=function(){var t,e=R("iframe"),r=ft.length;for(e.style.display="none",mt.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),wt=t.F;r--;)delete wt.prototype[ft[r]];return wt()},Ot=Object.create||function(t,e){var r;return null!==t?(vt.prototype=T(t),r=new vt,vt.prototype=null,r[bt]=t):r=wt(),void 0===e?r:dt(r,e)},St=ft.concat("length","prototype"),Rt={f:Object.getOwnPropertyNames||function(t){return at(t,St)}},Pt=Rt.f,jt={}.toString,Et="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],_t={f:function(t){return Et&&"[object Window]"==jt.call(t)?function(t){try{return Pt(t)}catch(t){return Et.slice()}}(t):Pt(f(t))}},Ft=K.KEY,Tt=E.f,kt=q.f,qt=_t.f,xt=w.Symbol,Nt=w.JSON,It=Nt&&Nt.stringify,Dt=H("_hidden"),Ct=H("toPrimitive"),Mt={}.propertyIsEnumerable,At=Y("symbol-registry"),Wt=Y("symbols"),$t=Y("op-symbols"),Jt=Object.prototype,zt="function"==typeof xt&&!!lt.f,Gt=w.QObject,Kt=!Gt||!Gt.prototype||!Gt.prototype.findChild,Yt=b&&m(function(){return 7!=Ot(kt({},"a",{get:function(){return kt(this,"a",{value:7}).a}})).a})?function(t,e,r){var n=Tt(Jt,e);n&&delete Jt[e],kt(t,e,r),n&&t!==Jt&&kt(Jt,e,n)}:kt,Ht=function(t){var e=Wt[t]=Ot(xt.prototype);return e._k=t,e},Lt=zt&&"symbol"==typeof xt.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof xt},Ut=function(t,e,r){return t===Jt&&Ut($t,e,r),T(t),e=y(e,!0),T(r),g(Wt,e)?(r.enumerable?(g(t,Dt)&&t[Dt][e]&&(t[Dt][e]=!1),r=Ot(r,{enumerable:l(0,!1)})):(g(t,Dt)||kt(t,Dt,l(1,{})),t[Dt][e]=!0),Yt(t,e,r)):kt(t,e,r)},Bt=function(t,e){T(t);for(var r,n=function(t){var e=pt(t),r=lt.f;if(r)for(var n,o=r(t),i=p.f,s=0;o.length>s;)i.call(t,n=o[s++])&&e.push(n);return e}(e=f(e)),o=0,i=n.length;i>o;)Ut(t,r=n[o++],e[r]);return t},Qt=function(t){var e=Mt.call(this,t=y(t,!0));return!(this===Jt&&g(Wt,t)&&!g($t,t))&&(!(e||!g(this,t)||!g(Wt,t)||g(this,Dt)&&this[Dt][t])||e)},Zt=function(t,e){if(t=f(t),e=y(e,!0),t!==Jt||!g(Wt,e)||g($t,e)){var r=Tt(t,e);return!r||!g(Wt,e)||g(t,Dt)&&t[Dt][e]||(r.enumerable=!0),r}},Vt=function(t){for(var e,r=qt(f(t)),n=[],o=0;r.length>o;)g(Wt,e=r[o++])||e==Dt||e==Ft||n.push(e);return n},Xt=function(t){for(var e,r=t===Jt,n=qt(r?$t:f(t)),o=[],i=0;n.length>i;)!g(Wt,e=n[i++])||r&&!g(Jt,e)||o.push(Wt[e]);return o};zt||($((xt=function(){if(this instanceof xt)throw TypeError("Symbol is not a constructor!");var t=G(arguments.length>0?arguments[0]:void 0),e=function(r){this===Jt&&e.call($t,r),g(this,Dt)&&g(this[Dt],t)&&(this[Dt][t]=!1),Yt(this,t,l(1,r))};return b&&Kt&&Yt(Jt,t,{configurable:!0,set:e}),Ht(t)}).prototype,"toString",function(){return this._k}),E.f=Zt,q.f=Ut,Rt.f=_t.f=Vt,p.f=Qt,lt.f=Xt,Q.f=function(t){return Ht(H(t))}),I(I.G+I.W+I.F*!zt,{Symbol:xt});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ee=0;te.length>ee;)H(te[ee++]);for(var re=pt(H.store),ne=0;re.length>ne;)V(re[ne++]);I(I.S+I.F*!zt,"Symbol",{for:function(t){return g(At,t+="")?At[t]:At[t]=xt(t)},keyFor:function(t){if(!Lt(t))throw TypeError(t+" is not a symbol!");for(var e in At)if(At[e]===t)return e},useSetter:function(){Kt=!0},useSimple:function(){Kt=!1}}),I(I.S+I.F*!zt,"Object",{create:function(t,e){return void 0===e?Ot(t):Bt(Ot(t),e)},defineProperty:Ut,defineProperties:Bt,getOwnPropertyDescriptor:Zt,getOwnPropertyNames:Vt,getOwnPropertySymbols:Xt});var oe=m(function(){lt.f(1)});I(I.S+I.F*oe,"Object",{getOwnPropertySymbols:function(t){return lt.f(yt(t))}}),Nt&&I(I.S+I.F*(!zt||m(function(){var t=xt();return"[null]"!=It([t])||"{}"!=It({a:t})||"{}"!=It(Object(t))})),"JSON",{stringify:function(t){for(var e,r,n=[t],o=1;arguments.length>o;)n.push(arguments[o++]);if(r=e=n[1],(h(e)||void 0!==t)&&!Lt(t))return ht(e)||(e=function(t,e){if("function"==typeof r&&(e=r.call(this,t,e)),!Lt(e))return e}),n[1]=e,It.apply(Nt,n)}}),xt.prototype[Ct]||x(xt.prototype,Ct,xt.prototype.valueOf),B(xt,"Symbol"),B(Math,"Math",!0),B(w.JSON,"JSON",!0);var ie=_.Object.getOwnPropertySymbols;D("keys",function(){return function(t){return pt(yt(t))}});var se=_.Object.keys;I(I.S+I.F*!b,"Object",{defineProperty:q.f});var ue=_.Object,ce=function(t,e,r){return ue.defineProperty(t,e,r)};var ae=function(t,e,r){return e in t?ce(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t};var fe,pe=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=se(r);"function"==typeof ie&&(n=n.concat(ie(r).filter(function(t){return W(r,t).enumerable}))),n.forEach(function(e){ae(t,e,r[e])})}return t},le=Object.freeze({});V("asyncIterator"),V("observable"),(fe=le)&&fe.default;var he=_.Symbol,ye="\t\n\v\f\r Â áá ââââââââââââ¯âã\u2028\u2029\ufeff",de="["+ye+"]",ge=RegExp("^"+de+de+"*"),me=RegExp(de+de+"*$"),be=function(t,e,r){var n={},o=m(function(){return!!ye[t]()||"âÂ"!="âÂ"[t]()}),i=n[t]=o?e(ve):ye[t];r&&(n[r]=i),I(I.P+I.F*o,"String",n)},ve=be.trim=function(t,e){return t=String(a(t)),1&e&&(t=t.replace(ge,"")),2&e&&(t=t.replace(me,"")),t},we=be,Oe=w.parseFloat,Se=we.trim,Re=1/Oe(ye+"-0")!=-1/0?function(t){var e=Se(String(t),3),r=Oe(e);return 0===r&&"-"==e.charAt(0)?-0:r}:Oe;I(I.G+I.F*(parseFloat!=Re),{parseFloat:Re});var Pe=_.parseFloat;const je=/([0-9.]+)([a-zA-Z]+)/g,Ee={ms:1,millisecond:1,milliseconds:1,s:1e3,sec:1e3,secs:1e3,second:1e3,seconds:1e3,m:6e4,min:6e4,mins:6e4,minute:6e4,minutes:6e4,h:36e5,hr:36e5,hrs:36e5,hour:36e5,hours:36e5,d:864e5,day:864e5,days:864e5,w:6048e5,wk:6048e5,wks:6048e5,week:6048e5,weeks:6048e5,y:31536e6,yr:31536e6,yrs:31536e6,year:31536e6,years:31536e6};function _e(t,e){return!(!t||!e)&&new Date>new Date(new Date(t).getTime()+("string"!=typeof(r=e)?NaN:r.replace(/ /g,"").match(je).map(t=>t.split(je).filter(t=>t)).reduce((t,[e,r])=>t+Pe(e)*Ee[r],0)));var r}var Fe=_.JSON||(_.JSON={stringify:JSON.stringify}),Te=function(t){return Fe.stringify.apply(Fe,arguments)};function ke(t,...e){const r=pe({},t.config);return["adapter","adapterOptions","persister","persisterOptions"].forEach(t=>delete r[t]),Te({url:t.url,method:t.method,headers:t.headers,body:t.body,recordingName:t.recordingName,id:t.id,order:t.order,identifiers:t.identifiers,config:r},...e)}const{isArray:qe}=Array;function xe(t){return(t||[]).reduce((t,{name:e,value:r,_fromType:n})=>{const o=t[e];return o?(qe(o)||(t[e]=[o]),t[e].push(r)):t[e]="array"===n?[r]:r,t},{})}const Ne=he();export default class{constructor(t){this.polly=t,this.isConnected=!1}static get type(){return"adapter"}static get name(){t("Must override the static `name` getter.")}get defaultOptions(){return{}}get options(){const{name:t}=this.constructor;return pe({},this.defaultOptions||{},(this.polly.config.adapterOptions||{})[t]||{})}get persister(){return this.polly.persister}connect(){this.isConnected||(this.onConnect(),this.isConnected=!0)}disconnect(){this.isConnected&&(this.onDisconnect(),this.isConnected=!1)}timeout(t,{time:e}){const{timing:r}=t.config;if("function"==typeof r)return r(e)}async handleRequest(t){const e=this.polly.registerRequest(t);try{return e.on("identify",(...t)=>this.onIdentifyRequest(...t)),await e.setup(),await this.onRequest(e),await this[Ne](e),await this.onRequestFinished(e),e}catch(t){await this.onRequestFailed(e,t)}}async[Ne](t){const{mode:r}=this.polly,{_interceptor:n}=t;if(!t.shouldIntercept||(await this.intercept(t,n),!n.shouldIntercept))return r===e.PASSTHROUGH||t.shouldPassthrough||n.shouldPassthrough?this.passthrough(t):(this.assert("A persister must be configured in order to record and replay requests.",!!this.persister),r===e.RECORD?this.record(t):r===e.REPLAY?this.replay(t):void this.assert("Unhandled request: \n"+ke(t,null,2)))}async passthrough(t){return t.action=r.PASSTHROUGH,this.onPassthrough(t)}async intercept(t,e){if(t.action=r.INTERCEPT,await t._intercept(e),e.shouldIntercept)return this.onIntercept(t,t.response)}async record(t){return t.action=r.RECORD,"navigator"in global&&!navigator.onLine&&console.warn("[Polly] Recording may fail because the browser is offline.\n"+`${ke(t)}`),this.onRecord(t)}async replay(t){const{config:e}=t,o=await this.persister.findEntry(t);if(o){if(await t._emit("beforeReplay",o),_e(o.startedDateTime,e.expiresIn)){const r="Recording for the following request has expired.\n"+`${ke(t,null,2)}`;switch(e.expiryStrategy){case n.RECORD:return this.record(t);case n.ERROR:this.assert(r);break;case n.WARN:console.warn(`[Polly] ${r}`);break;default:this.assert(`Invalid config option passed for "expiryStrategy": "${e.expiryStrategy}"`)}}return await this.timeout(t,o),t.action=r.REPLAY,this.onReplay(t,function(t){const{status:e,statusText:r,headers:n,content:o}=t;return{statusText:r,statusCode:e,headers:xe(n),body:o&&o.text}}(o.response),o)}if(e.recordIfMissing)return this.record(t);this.assert("Recording for the following request is not found and `recordIfMissing` is `false`.\n"+ke(t,null,2))}assert(e,...r){t(`[${this.constructor.type}:${this.constructor.name}] ${e}`,...r)}onConnect(){this.assert("Must implement the `onConnect` hook.")}onDisconnect(){this.assert("Must implement the `onDisconnect` hook.")}async passthroughRequest(){this.assert("Must implement the `passthroughRequest` hook.")}async respondToRequest(){}async onRecord(t){await this.onPassthrough(t),await this.persister.recordRequest(t)}async onReplay(t,e){await t.respond(e)}async onIntercept(t,e){await t.respond(e)}async onPassthrough(t){const e=await this.passthroughRequest(t);await t.respond(e)}async onIdentifyRequest(t){const{identifiers:e}=t;for(const t of["blob","formData","buffer"])e.body=await o[t](e.body)}onRequest(){}async onRequestFinished(t){await this.respondToRequest(t),t.promise.resolve()}async onRequestFailed(t,e){e=e||new i("Request failed due to an unknown error.");try{await t._emit("error",e),await this.respondToRequest(t,e)}catch(t){throw t}finally{t.promise.reject(e)}}}
//# sourceMappingURL=pollyjs-adapter.min.js.map
