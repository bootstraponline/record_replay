import t from"http";import e from"https";import n from"url";import{Readable as r}from"stream";import o from"nock";import i from"semver";import u from"@pollyjs/adapter";import{URL as c,HTTP_METHODS as s}from"@pollyjs/utils";var f=Math.ceil,a=Math.floor,l=function(t){return isNaN(t=+t)?0:(t>0?a:f)(t)},p=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t};function h(t,e){return t(e={exports:{}},e.exports),e.exports}var v=h(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),y=h(function(t){var e=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=e)}),d=(y.version,function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}),m=function(t,e,n){if(d(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}},g=function(t){return"object"==typeof t?null!==t:"function"==typeof t},b=function(t){if(!g(t))throw TypeError(t+" is not an object!");return t},_=function(t){try{return!!t()}catch(t){return!0}},w=!_(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),O=v.document,S=g(O)&&g(O.createElement),j=function(t){return S?O.createElement(t):{}},P=!w&&!_(function(){return 7!=Object.defineProperty(j("div"),"a",{get:function(){return 7}}).a}),E=function(t,e){if(!g(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!g(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!g(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!g(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},k=Object.defineProperty,x={f:w?Object.defineProperty:function(t,e,n){if(b(t),e=E(e,!0),b(n),P)try{return k(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},A=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},C=w?function(t,e,n){return x.f(t,e,A(1,n))}:function(t,e,n){return t[e]=n,t},M={}.hasOwnProperty,T=function(t,e){return M.call(t,e)},L=function(t,e,n){var r,o,i,u=t&L.F,c=t&L.G,s=t&L.S,f=t&L.P,a=t&L.B,l=t&L.W,p=c?y:y[e]||(y[e]={}),h=p.prototype,d=c?v:s?v[e]:(v[e]||{}).prototype;for(r in c&&(n=e),n)(o=!u&&d&&void 0!==d[r])&&T(p,r)||(i=o?d[r]:n[r],p[r]=c&&"function"!=typeof d[r]?n[r]:a&&o?m(i,v):l&&d[r]==i?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(i):f&&"function"==typeof i?m(Function.call,i):i,f&&((p.virtual||(p.virtual={}))[r]=i,t&L.R&&h&&!h[r]&&C(h,r,i)))};L.F=1,L.G=2,L.S=4,L.P=8,L.B=16,L.W=32,L.U=64,L.R=128;var N,F=L,R=C,B={},q={}.toString,W=function(t){return q.call(t).slice(8,-1)},D=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==W(t)?t.split(""):Object(t)},I=function(t){return D(p(t))},G=Math.min,J=function(t){return t>0?G(l(t),9007199254740991):0},K=Math.max,V=Math.min,z=h(function(t){var e=v["__core-js_shared__"]||(v["__core-js_shared__"]={});(t.exports=function(t,n){return e[t]||(e[t]=void 0!==n?n:{})})("versions",[]).push({version:y.version,mode:"pure",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),U=0,H=Math.random(),Y=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++U+H).toString(36))},X=z("keys"),$=function(t){return X[t]||(X[t]=Y(t))},Q=(N=!1,function(t,e,n){var r,o=I(t),i=J(o.length),u=function(t,e){return(t=l(t))<0?K(t+e,0):V(t,e)}(n,i);if(N&&e!=e){for(;i>u;)if((r=o[u++])!=r)return!0}else for(;i>u;u++)if((N||u in o)&&o[u]===e)return N||u||0;return!N&&-1}),Z=$("IE_PROTO"),tt=function(t,e){var n,r=I(t),o=0,i=[];for(n in r)n!=Z&&T(r,n)&&i.push(n);for(;e.length>o;)T(r,n=e[o++])&&(~Q(i,n)||i.push(n));return i},et="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),nt=Object.keys||function(t){return tt(t,et)},rt=w?Object.defineProperties:function(t,e){b(t);for(var n,r=nt(e),o=r.length,i=0;o>i;)x.f(t,n=r[i++],e[n]);return t},ot=v.document,it=ot&&ot.documentElement,ut=$("IE_PROTO"),ct=function(){},st=function(){var t,e=j("iframe"),n=et.length;for(e.style.display="none",it.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),st=t.F;n--;)delete st.prototype[et[n]];return st()},ft=Object.create||function(t,e){var n;return null!==t?(ct.prototype=b(t),n=new ct,ct.prototype=null,n[ut]=t):n=st(),void 0===e?n:rt(n,e)},at=h(function(t){var e=z("wks"),n=v.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:Y)("Symbol."+t))}).store=e}),lt=x.f,pt=at("toStringTag"),ht=function(t,e,n){t&&!T(t=n?t:t.prototype,pt)&&lt(t,pt,{configurable:!0,value:e})},vt={};C(vt,at("iterator"),function(){return this});var yt,dt=function(t,e,n){t.prototype=ft(vt,{next:A(1,n)}),ht(t,e+" Iterator")},mt=function(t){return Object(p(t))},gt=$("IE_PROTO"),bt=Object.prototype,_t=Object.getPrototypeOf||function(t){return t=mt(t),T(t,gt)?t[gt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?bt:null},wt=at("iterator"),Ot=!([].keys&&"next"in[].keys()),St=function(){return this},jt=function(t,e,n,r,o,i,u){dt(n,e,r);var c,s,f,a=function(t){if(!Ot&&t in v)return v[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},l=e+" Iterator",p="values"==o,h=!1,v=t.prototype,y=v[wt]||v["@@iterator"]||o&&v[o],d=y||a(o),m=o?p?a("entries"):d:void 0,g="Array"==e&&v.entries||y;if(g&&(f=_t(g.call(new t)))!==Object.prototype&&f.next&&ht(f,l,!0),p&&y&&"values"!==y.name&&(h=!0,d=function(){return y.call(this)}),u&&(Ot||h||!v[wt])&&C(v,wt,d),B[e]=d,B[l]=St,o)if(c={values:p?d:a("values"),keys:i?d:a("keys"),entries:m},u)for(s in c)s in v||R(v,s,c[s]);else F(F.P+F.F*(Ot||h),e,c);return c},Pt=(yt=!0,function(t,e){var n,r,o=String(p(t)),i=l(e),u=o.length;return i<0||i>=u?yt?"":void 0:(n=o.charCodeAt(i))<55296||n>56319||i+1===u||(r=o.charCodeAt(i+1))<56320||r>57343?yt?o.charAt(i):n:yt?o.slice(i,i+2):r-56320+(n-55296<<10)+65536});jt(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=Pt(e,n),this._i+=t.length,{value:t,done:!1})});var Et=function(t,e){return{value:e,done:!!t}};jt(Array,"Array",function(t,e){this._t=I(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,Et(1)):Et(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])},"values");B.Arguments=B.Array;for(var kt=at("toStringTag"),xt="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),At=0;At<xt.length;At++){var Ct=xt[At],Mt=v[Ct],Tt=Mt&&Mt.prototype;Tt&&!Tt[kt]&&C(Tt,kt,Ct),B[Ct]=B.Array}var Lt,Nt,Ft,Rt=at("toStringTag"),Bt="Arguments"==W(function(){return arguments}()),qt=function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Rt))?n:Bt?W(e):"Object"==(r=W(e))&&"function"==typeof e.callee?"Arguments":r},Wt=function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!");return t},Dt=function(t,e,n,r){try{return r?e(b(n)[0],n[1]):e(n)}catch(e){var o=t.return;throw void 0!==o&&b(o.call(t)),e}},It=at("iterator"),Gt=Array.prototype,Jt=at("iterator"),Kt=y.getIteratorMethod=function(t){if(null!=t)return t[Jt]||t["@@iterator"]||B[qt(t)]},Vt=h(function(t){var e={},n={},r=t.exports=function(t,r,o,i,u){var c,s,f,a,l,p=u?function(){return t}:Kt(t),h=m(o,i,r?2:1),v=0;if("function"!=typeof p)throw TypeError(t+" is not iterable!");if(void 0===(l=p)||B.Array!==l&&Gt[It]!==l){for(f=p.call(t);!(s=f.next()).done;)if((a=Dt(f,h,s.value,r))===e||a===n)return a}else for(c=J(t.length);c>v;v++)if((a=r?h(b(s=t[v])[0],s[1]):h(t[v]))===e||a===n)return a};r.BREAK=e,r.RETURN=n}),zt=at("species"),Ut=function(t,e){var n,r=b(t).constructor;return void 0===r||null==(n=b(r)[zt])?e:d(n)},Ht=v.process,Yt=v.setImmediate,Xt=v.clearImmediate,$t=v.MessageChannel,Qt=v.Dispatch,Zt=0,te={},ee=function(){var t=+this;if(te.hasOwnProperty(t)){var e=te[t];delete te[t],e()}},ne=function(t){ee.call(t.data)};Yt&&Xt||(Yt=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return te[++Zt]=function(){!function(t,e,n){var r=void 0===n;switch(e.length){case 0:return r?t():t.call(n);case 1:return r?t(e[0]):t.call(n,e[0]);case 2:return r?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}t.apply(n,e)}("function"==typeof t?t:Function(t),e)},Lt(Zt),Zt},Xt=function(t){delete te[t]},"process"==W(Ht)?Lt=function(t){Ht.nextTick(m(ee,t,1))}:Qt&&Qt.now?Lt=function(t){Qt.now(m(ee,t,1))}:$t?(Ft=(Nt=new $t).port2,Nt.port1.onmessage=ne,Lt=m(Ft.postMessage,Ft,1)):v.addEventListener&&"function"==typeof postMessage&&!v.importScripts?(Lt=function(t){v.postMessage(t+"","*")},v.addEventListener("message",ne,!1)):Lt="onreadystatechange"in j("script")?function(t){it.appendChild(j("script")).onreadystatechange=function(){it.removeChild(this),ee.call(t)}}:function(t){setTimeout(m(ee,t,1),0)});var re={set:Yt,clear:Xt},oe=re.set,ie=v.MutationObserver||v.WebKitMutationObserver,ue=v.process,ce=v.Promise,se="process"==W(ue);function fe(t){var e,n;this.promise=new t(function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r}),this.resolve=d(e),this.reject=d(n)}var ae={f:function(t){return new fe(t)}},le=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}},pe=v.navigator,he=pe&&pe.userAgent||"",ve=function(t,e){if(b(t),g(e)&&e.constructor===t)return e;var n=ae.f(t);return(0,n.resolve)(e),n.promise},ye=function(t,e,n){for(var r in e)n&&t[r]?t[r]=e[r]:C(t,r,e[r]);return t},de=at("species"),me=at("iterator"),ge=!1;try{var be=[7][me]();be.return=function(){ge=!0},Array.from(be,function(){throw 2})}catch(t){}var _e,we,Oe,Se,je,Pe,Ee=re.set,ke=function(){var t,e,n,r=function(){var r,o;for(se&&(r=ue.domain)&&r.exit();t;){o=t.fn,t=t.next;try{o()}catch(r){throw t?n():e=void 0,r}}e=void 0,r&&r.enter()};if(se)n=function(){ue.nextTick(r)};else if(!ie||v.navigator&&v.navigator.standalone)if(ce&&ce.resolve){var o=ce.resolve(void 0);n=function(){o.then(r)}}else n=function(){oe.call(v,r)};else{var i=!0,u=document.createTextNode("");new ie(r).observe(u,{characterData:!0}),n=function(){u.data=i=!i}}return function(r){var o={fn:r,next:void 0};e&&(e.next=o),t||(t=o,n()),e=o}}(),xe=v.TypeError,Ae=v.process,Ce=Ae&&Ae.versions,Me=Ce&&Ce.v8||"",Te=v.Promise,Le="process"==qt(Ae),Ne=function(){},Fe=we=ae.f,Re=!!function(){try{var t=Te.resolve(1),e=(t.constructor={})[at("species")]=function(t){t(Ne,Ne)};return(Le||"function"==typeof PromiseRejectionEvent)&&t.then(Ne)instanceof e&&0!==Me.indexOf("6.6")&&-1===he.indexOf("Chrome/66")}catch(t){}}(),Be=function(t){var e;return!(!g(t)||"function"!=typeof(e=t.then))&&e},qe=function(t,e){if(!t._n){t._n=!0;var n=t._c;ke(function(){for(var r=t._v,o=1==t._s,i=0,u=function(e){var n,i,u,c=o?e.ok:e.fail,s=e.resolve,f=e.reject,a=e.domain;try{c?(o||(2==t._h&&Ie(t),t._h=1),!0===c?n=r:(a&&a.enter(),n=c(r),a&&(a.exit(),u=!0)),n===e.promise?f(xe("Promise-chain cycle")):(i=Be(n))?i.call(n,s,f):s(n)):f(r)}catch(t){a&&!u&&a.exit(),f(t)}};n.length>i;)u(n[i++]);t._c=[],t._n=!1,e&&!t._h&&We(t)})}},We=function(t){Ee.call(v,function(){var e,n,r,o=t._v,i=De(t);if(i&&(e=le(function(){Le?Ae.emit("unhandledRejection",o,t):(n=v.onunhandledrejection)?n({promise:t,reason:o}):(r=v.console)&&r.error&&r.error("Unhandled promise rejection",o)}),t._h=Le||De(t)?2:1),t._a=void 0,i&&e.e)throw e.v})},De=function(t){return 1!==t._h&&0===(t._a||t._c).length},Ie=function(t){Ee.call(v,function(){var e;Le?Ae.emit("rejectionHandled",t):(e=v.onrejectionhandled)&&e({promise:t,reason:t._v})})},Ge=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),qe(e,!0))},Je=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw xe("Promise can't be resolved itself");(e=Be(t))?ke(function(){var r={_w:n,_d:!1};try{e.call(t,m(Je,r,1),m(Ge,r,1))}catch(t){Ge.call(r,t)}}):(n._v=t,n._s=1,qe(n,!1))}catch(t){Ge.call({_w:n,_d:!1},t)}}};Re||(Te=function(t){Wt(this,Te,"Promise","_h"),d(t),_e.call(this);try{t(m(Je,this,1),m(Ge,this,1))}catch(t){Ge.call(this,t)}},(_e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=ye(Te.prototype,{then:function(t,e){var n=Fe(Ut(this,Te));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=Le?Ae.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&qe(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),Oe=function(){var t=new _e;this.promise=t,this.resolve=m(Je,t,1),this.reject=m(Ge,t,1)},ae.f=Fe=function(t){return t===Te||t===Se?new Oe(t):we(t)}),F(F.G+F.W+F.F*!Re,{Promise:Te}),ht(Te,"Promise"),Pe="function"==typeof y[je="Promise"]?y[je]:v[je],w&&Pe&&!Pe[de]&&x.f(Pe,de,{configurable:!0,get:function(){return this}}),Se=y.Promise,F(F.S+F.F*!Re,"Promise",{reject:function(t){var e=Fe(this);return(0,e.reject)(t),e.promise}}),F(F.S+!0*F.F,"Promise",{resolve:function(t){return ve(this===Se?Te:this,t)}}),F(F.S+F.F*!(Re&&function(t,e){if(!e&&!ge)return!1;var n=!1;try{var r=[7],o=r[me]();o.next=function(){return{done:n=!0}},r[me]=function(){return o},t(r)}catch(t){}return n}(function(t){Te.all(t).catch(Ne)})),"Promise",{all:function(t){var e=this,n=Fe(e),r=n.resolve,o=n.reject,i=le(function(){var n=[],i=0,u=1;Vt(t,!1,function(t){var c=i++,s=!1;n.push(void 0),u++,e.resolve(t).then(function(t){s||(s=!0,n[c]=t,--u||r(n))},o)}),--u||r(n)});return i.e&&o(i.v),n.promise},race:function(t){var e=this,n=Fe(e),r=n.reject,o=le(function(){Vt(t,!1,function(t){e.resolve(t).then(n.resolve,r)})});return o.e&&r(o.v),n.promise}}),F(F.P+F.R,"Promise",{finally:function(t){var e=Ut(this,y.Promise||v.Promise),n="function"==typeof t;return this.then(n?function(n){return ve(e,t()).then(function(){return n})}:t,n?function(n){return ve(e,t()).then(function(){throw n})}:t)}}),F(F.S,"Promise",{try:function(t){var e=ae.f(this),n=le(t);return(n.e?e.reject:e.resolve)(n.v),e.promise}});var Ke=y.Promise,Ve={f:{}.propertyIsEnumerable},ze=Object.getOwnPropertyDescriptor,Ue={f:w?ze:function(t,e){if(t=I(t),e=E(e,!0),P)try{return ze(t,e)}catch(t){}if(T(t,e))return A(!Ve.f.call(t,e),t[e])}},He=function(t,e){var n=(y.Object||{})[t]||Object[t],r={};r[t]=e(n),F(F.S+F.F*_(function(){n(1)}),"Object",r)},Ye=Ue.f;He("getOwnPropertyDescriptor",function(){return function(t,e){return Ye(I(t),e)}});var Xe=y.Object,$e=function(t,e){return Xe.getOwnPropertyDescriptor(t,e)},Qe=h(function(t){var e=Y("meta"),n=x.f,r=0,o=Object.isExtensible||function(){return!0},i=!_(function(){return o(Object.preventExtensions({}))}),u=function(t){n(t,e,{value:{i:"O"+ ++r,w:{}}})},c=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!g(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!T(t,e)){if(!o(t))return"F";if(!n)return"E";u(t)}return t[e].i},getWeak:function(t,n){if(!T(t,e)){if(!o(t))return!0;if(!n)return!1;u(t)}return t[e].w},onFreeze:function(t){return i&&c.NEED&&o(t)&&!T(t,e)&&u(t),t}}}),Ze=(Qe.KEY,Qe.NEED,Qe.fastKey,Qe.getWeak,Qe.onFreeze,{f:at}),tn=x.f,en=function(t){var e=y.Symbol||(y.Symbol={});"_"==t.charAt(0)||t in e||tn(e,t,{value:Ze.f(t)})},nn={f:Object.getOwnPropertySymbols},rn=Array.isArray||function(t){return"Array"==W(t)},on=et.concat("length","prototype"),un={f:Object.getOwnPropertyNames||function(t){return tt(t,on)}},cn=un.f,sn={}.toString,fn="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],an={f:function(t){return fn&&"[object Window]"==sn.call(t)?function(t){try{return cn(t)}catch(t){return fn.slice()}}(t):cn(I(t))}},ln=Qe.KEY,pn=Ue.f,hn=x.f,vn=an.f,yn=v.Symbol,dn=v.JSON,mn=dn&&dn.stringify,gn=at("_hidden"),bn=at("toPrimitive"),_n={}.propertyIsEnumerable,wn=z("symbol-registry"),On=z("symbols"),Sn=z("op-symbols"),jn=Object.prototype,Pn="function"==typeof yn&&!!nn.f,En=v.QObject,kn=!En||!En.prototype||!En.prototype.findChild,xn=w&&_(function(){return 7!=ft(hn({},"a",{get:function(){return hn(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=pn(jn,e);r&&delete jn[e],hn(t,e,n),r&&t!==jn&&hn(jn,e,r)}:hn,An=function(t){var e=On[t]=ft(yn.prototype);return e._k=t,e},Cn=Pn&&"symbol"==typeof yn.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof yn},Mn=function(t,e,n){return t===jn&&Mn(Sn,e,n),b(t),e=E(e,!0),b(n),T(On,e)?(n.enumerable?(T(t,gn)&&t[gn][e]&&(t[gn][e]=!1),n=ft(n,{enumerable:A(0,!1)})):(T(t,gn)||hn(t,gn,A(1,{})),t[gn][e]=!0),xn(t,e,n)):hn(t,e,n)},Tn=function(t,e){b(t);for(var n,r=function(t){var e=nt(t),n=nn.f;if(n)for(var r,o=n(t),i=Ve.f,u=0;o.length>u;)i.call(t,r=o[u++])&&e.push(r);return e}(e=I(e)),o=0,i=r.length;i>o;)Mn(t,n=r[o++],e[n]);return t},Ln=function(t){var e=_n.call(this,t=E(t,!0));return!(this===jn&&T(On,t)&&!T(Sn,t))&&(!(e||!T(this,t)||!T(On,t)||T(this,gn)&&this[gn][t])||e)},Nn=function(t,e){if(t=I(t),e=E(e,!0),t!==jn||!T(On,e)||T(Sn,e)){var n=pn(t,e);return!n||!T(On,e)||T(t,gn)&&t[gn][e]||(n.enumerable=!0),n}},Fn=function(t){for(var e,n=vn(I(t)),r=[],o=0;n.length>o;)T(On,e=n[o++])||e==gn||e==ln||r.push(e);return r},Rn=function(t){for(var e,n=t===jn,r=vn(n?Sn:I(t)),o=[],i=0;r.length>i;)!T(On,e=r[i++])||n&&!T(jn,e)||o.push(On[e]);return o};Pn||(R((yn=function(){if(this instanceof yn)throw TypeError("Symbol is not a constructor!");var t=Y(arguments.length>0?arguments[0]:void 0),e=function(n){this===jn&&e.call(Sn,n),T(this,gn)&&T(this[gn],t)&&(this[gn][t]=!1),xn(this,t,A(1,n))};return w&&kn&&xn(jn,t,{configurable:!0,set:e}),An(t)}).prototype,"toString",function(){return this._k}),Ue.f=Nn,x.f=Mn,un.f=an.f=Fn,Ve.f=Ln,nn.f=Rn,Ze.f=function(t){return An(at(t))}),F(F.G+F.W+F.F*!Pn,{Symbol:yn});for(var Bn="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),qn=0;Bn.length>qn;)at(Bn[qn++]);for(var Wn=nt(at.store),Dn=0;Wn.length>Dn;)en(Wn[Dn++]);F(F.S+F.F*!Pn,"Symbol",{for:function(t){return T(wn,t+="")?wn[t]:wn[t]=yn(t)},keyFor:function(t){if(!Cn(t))throw TypeError(t+" is not a symbol!");for(var e in wn)if(wn[e]===t)return e},useSetter:function(){kn=!0},useSimple:function(){kn=!1}}),F(F.S+F.F*!Pn,"Object",{create:function(t,e){return void 0===e?ft(t):Tn(ft(t),e)},defineProperty:Mn,defineProperties:Tn,getOwnPropertyDescriptor:Nn,getOwnPropertyNames:Fn,getOwnPropertySymbols:Rn});var In=_(function(){nn.f(1)});F(F.S+F.F*In,"Object",{getOwnPropertySymbols:function(t){return nn.f(mt(t))}}),dn&&F(F.S+F.F*(!Pn||_(function(){var t=yn();return"[null]"!=mn([t])||"{}"!=mn({a:t})||"{}"!=mn(Object(t))})),"JSON",{stringify:function(t){for(var e,n,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);if(n=e=r[1],(g(e)||void 0!==t)&&!Cn(t))return rn(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!Cn(e))return e}),r[1]=e,mn.apply(dn,r)}}),yn.prototype[bn]||C(yn.prototype,bn,yn.prototype.valueOf),ht(yn,"Symbol"),ht(Math,"Math",!0),ht(v.JSON,"JSON",!0);var Gn=y.Object.getOwnPropertySymbols;He("keys",function(){return function(t){return nt(mt(t))}});var Jn=y.Object.keys;F(F.S+F.F*!w,"Object",{defineProperty:x.f});var Kn=y.Object,Vn=function(t,e,n){return Kn.defineProperty(t,e,n)};var zn=function(t,e,n){return e in t?Vn(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t};var Un=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Jn(n);"function"==typeof Gn&&(r=r.concat(Gn(n).filter(function(t){return $e(n,t).enumerable}))),r.forEach(function(e){zn(t,e,n[e])})}return t},Hn=y.JSON||(y.JSON={stringify:JSON.stringify}),Yn=function(t){return Hn.stringify.apply(Hn,arguments)},Xn=at("species"),$n=function(t,e){return new(function(t){var e;return rn(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!rn(e.prototype)||(e=void 0),g(e)&&null===(e=e[Xn])&&(e=void 0)),void 0===e?Array:e}(t))(e)},Qn=function(t,e){var n=1==t,r=2==t,o=3==t,i=4==t,u=6==t,c=5==t||u,s=e||$n;return function(e,f,a){for(var l,p,h=mt(e),v=D(h),y=m(f,a,3),d=J(v.length),g=0,b=n?s(e,d):r?s(e,0):void 0;d>g;g++)if((c||g in v)&&(p=y(l=v[g],g,h),t))if(n)b[g]=p;else if(p)switch(t){case 3:return!0;case 5:return l;case 6:return g;case 2:b.push(l)}else if(i)return!1;return u?-1:o||i?i:b}},Zn=Object.assign,tr=!Zn||_(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=Zn({},t)[n]||Object.keys(Zn({},e)).join("")!=r})?function(t,e){for(var n=mt(t),r=arguments.length,o=1,i=nn.f,u=Ve.f;r>o;)for(var c,s=D(arguments[o++]),f=i?nt(s).concat(i(s)):nt(s),a=f.length,l=0;a>l;)c=f[l++],w&&!u.call(s,c)||(n[c]=s[c]);return n}:Zn,er=function(t,e){if(!g(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t},nr=Qe.getWeak,rr=Qn(5),or=Qn(6),ir=0,ur=function(t){return t._l||(t._l=new cr)},cr=function(){this.a=[]},sr=function(t,e){return rr(t.a,function(t){return t[0]===e})};cr.prototype={get:function(t){var e=sr(this,t);if(e)return e[1]},has:function(t){return!!sr(this,t)},set:function(t,e){var n=sr(this,t);n?n[1]=e:this.a.push([t,e])},delete:function(t){var e=or(this.a,function(e){return e[0]===t});return~e&&this.a.splice(e,1),!!~e}};var fr,ar={getConstructor:function(t,e,n,r){var o=t(function(t,i){Wt(t,o,e,"_i"),t._t=e,t._i=ir++,t._l=void 0,null!=i&&Vt(i,n,t[r],t)});return ye(o.prototype,{delete:function(t){if(!g(t))return!1;var n=nr(t);return!0===n?ur(er(this,e)).delete(t):n&&T(n,this._i)&&delete n[this._i]},has:function(t){if(!g(t))return!1;var n=nr(t);return!0===n?ur(er(this,e)).has(t):n&&T(n,this._i)}}),o},def:function(t,e,n){var r=nr(b(e),!0);return!0===r?ur(t).set(e,n):r[t._i]=n,t},ufstore:ur},lr=x.f,pr=Qn(0),hr=function(t,e,n,r,o,i){var u=v[t],c=u,s=o?"set":"add",f=c&&c.prototype,a={};return w&&"function"==typeof c&&(i||f.forEach&&!_(function(){(new c).entries().next()}))?(c=e(function(e,n){Wt(e,c,t,"_c"),e._c=new u,null!=n&&Vt(n,o,e[s],e)}),pr("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(t){var e="add"==t||"set"==t;t in f&&(!i||"clear"!=t)&&C(c.prototype,t,function(n,r){if(Wt(this,c,t),!e&&i&&!g(n))return"get"==t&&void 0;var o=this._c[t](0===n?0:n,r);return e?this:o})}),i||lr(c.prototype,"size",{get:function(){return this._c.size}})):(c=r.getConstructor(e,t,o,s),ye(c.prototype,n),Qe.NEED=!0),ht(c,t),a[t]=c,F(F.G+F.W+F.F,a),i||r.setStrong(c,t,o),c};h(function(t){var e,n=Qn(0),r=er,o=!v.ActiveXObject&&"ActiveXObject"in v,i=Qe.getWeak,u=Object.isExtensible,c=ar.ufstore,s=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},f={get:function(t){if(g(t)){var e=i(t);return!0===e?c(er(this,"WeakMap")).get(t):e?e[this._i]:void 0}},set:function(t,e){return ar.def(er(this,"WeakMap"),t,e)}},a=t.exports=hr("WeakMap",s,f,ar,!0,!0);r&&o&&(e=ar.getConstructor(s,"WeakMap"),tr(e.prototype,f),Qe.NEED=!0,n(["delete","has","get","set"],function(t){var n=a.prototype,r=n[t];R(n,t,function(n,o){if(g(n)&&!u(n)){this._f||(this._f=new e);var i=this._f[t](n,o);return"set"==t?this:i}return r.call(this,n,o)})}))});fr="WeakMap",F(F.S,fr,{of:function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}});!function(t){F(F.S,t,{from:function(t){var e,n,r,o,i=arguments[1];return d(this),(e=void 0!==i)&&d(i),null==t?new this:(n=[],e?(r=0,o=m(i,arguments[2],2),Vt(t,!1,function(t){n.push(o(t,r++))})):Vt(t,!1,n.push,n),new this(n))}})}("WeakMap");var vr=y.WeakMap;en("asyncIterator"),en("observable");var yr=y.Symbol;const{URL:dr,parse:mr}=n;function gr(t,e,n){return"string"==typeof t?t=mr(t):dr&&t instanceof dr?t=mr(`${t}`):(n=e,e=t,t=null),"function"==typeof e&&(n=e,e=null),{options:e=Un({},t||{},e||{}),callback:n}}function br(t){if(!Buffer.isBuffer(t))return!1;const e=t.toString("utf8");return!function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(t,Buffer.from(e,"utf8"))}function _r(t){const e=null!=(n=t)&&"object"==typeof n?t["content-encoding"]:"";var n;return!(!e||"string"!=typeof e)}const wr=yr(),Or=new vr;o.restore();export default class extends u{static get name(){return"node-http"}onConnect(){this.assert("Running concurrent node-http adapters is unsupported, stop any running Polly instances.",!t.ClientRequest[wr]),this.assert("Running nock concurrently with the node-http adapter is unsupported. Run nock.restore() before connecting to this adapter.",!o.isActive()),this.NativeClientRequest=t.ClientRequest,this.setupNock(),this.patchOverriddenMethods()}onDisconnect(){o.cleanAll(),o.restore(),this.NativeClientRequest=null}setupNock(){const t=this;o.cleanAll();const e=o(/.*/).persist();s.forEach(n=>{e.intercept(/.*/,n).reply(function(e,n,r){const{req:o,method:i}=this,{headers:u}=o,s=gr(...Or.get(o)),f=function(t={}){if(t.href)return t.href;const e=t.protocol||`${t.proto}:`||"http:",n=t.hostname||t.host||"localhost",{path:r,port:o}=t,i=new c;return i.set("protocol",e),i.set("host",n),i.set("pathname",r),!o||n.includes(":")||80===o&&"http:"===e||443===o&&"https:"===e||i.set("port",o),i.href}(s.options);n&&"string"!=typeof n&&(n=Yn(n)),t.handleRequest({url:f,method:i,headers:u,body:n,requestArguments:{req:o,body:n,respond:r,parsedArguments:s}})})}),o.activate()}patchOverriddenMethods(){const n={http:t,https:e},{ClientRequest:r}=t;t.ClientRequest=function(){const t=new r(...arguments);return Or.set(t,[...arguments]),t},t.ClientRequest[wr]=!0,Jn(n).forEach(t=>{const e=n[t],{request:r,get:o,globalAgent:u}=e,c=function(){const e=gr(...arguments);return e.options=Un({},"https"===t?{port:443,protocol:"https:",_defaultAgent:u}:{port:80,protocol:"http:"},e.options),e};e.request=function(){const{options:t,callback:e}=c(...arguments);return r(t,e)},i.satisfies(process.version,">=8")&&(e.get=function(){const{options:t,callback:e}=c(...arguments);return o(t,e)})})}async passthroughRequest(t){const{parsedArguments:e}=t.requestArguments,{method:r,headers:o,body:i}=t,{options:u}=e,c=new this.NativeClientRequest(Un({},u,{method:r,headers:Un({},o)},n.parse(t.url))),s=this.getChunksFromBody(i,o),f=new Ke((t,e)=>{c.once("response",t),c.once("error",e),c.once("timeout",e)});s.forEach(t=>c.write(t)),c.end();const a=await f,l=await new Ke((t,e)=>{const n=[];a.on("data",t=>n.push(t)),a.once("end",()=>t(this.getBodyFromChunks(n,a.headers))),a.once("error",e)});return{headers:a.headers,statusCode:a.statusCode,body:l}}async respondToRequest(t,e){const{req:n,respond:o}=t.requestArguments;if(e)return o(e),void n.emit("error",e);const{statusCode:i,body:u,headers:c}=t.response,s=this.getChunksFromBody(u,c),f=new r;s.forEach(t=>f.push(t)),f.push(null);const a=new Ke(t=>{n.aborted?t():(n.once("response",t),n.once("abort",t),n.once("error",t))});o(null,[i,f,c]),await a}getBodyFromChunks(t,e){if(_r(e)){const e=t.map(t=>(Buffer.isBuffer(t)||(this.assert("content-encoded responses must all be binary buffers","string"==typeof t),t=Buffer.from(t)),t.toString("hex")));return Yn(e)}const n=function(t){return t&&0!==t.length?Buffer.isBuffer(t[0])?Buffer.concat(t):t.join(""):Buffer.alloc(0)}(t);return n.toString(br(n)?"hex":"utf8")}getChunksFromBody(t,e){if(!t)return[];if(Buffer.isBuffer(t))return[t];if(_r(e))return JSON.parse(t).map(t=>Buffer.from(t,"hex"));const n=Buffer.from(t);return[Buffer.from(n,br(n)?"hex":"utf8")]}}
//# sourceMappingURL=pollyjs-adapter-node-http.min.js.map
